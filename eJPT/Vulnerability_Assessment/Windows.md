# Vulnerability Assessment : Windows
[Back](./index.md)

-- -

## Frequently exploited Microsoft services

|Protocol/Service | Ports | Purpose|
|:-|::|:-|
|Microsoft IIS (Internet Information Services) |TCP ports 80/443 |Proprietary web server software developed by Microsoft that runs on Windows. |
|WebDAV (Web Distributed Authoring & Versioning) | TCP ports 80/443 | HTTP extension that allows clients to update, delete, move and copy files on a web server. WebDAV is used to enable a web server to act as a file server.|
|SMB/CIFS (Server Message Block Protocol)| TCP port 445 | Network file sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a local network (LAN). |
|RDP(Remote Desktop Protocol) | TCP port 3389 | Proprietary GUI remote access protocol developed by Microsoft and is used to remotely authenticate and interact with a Windows system. |
| WinRM (Windows Remote Management Protocol) | TCP ports 5986/443| Windows remote management protocol that can be used to facilitate remote access with Windows systems.|

-- -

## WebDAB

WebDAV stands for Web-based Distributed Authoring and Versioning, an open standard that allows users to manage, edit, and create files remotely over the internet. It's an extension of the HTTP protocol that enables users to collaborate on web content.

- Supported executable file extensions:
	+ .asp
	+ .aspx
	+ .config
	+ .php

- Use Hydra to brute-force password. 

- Use Davtest tool to enumerate files, identify what file extensions can be uploaded.

```
/usr/bin/davtest -url <url> [options]

 -auth+         Authorization (user:password)
 -realm+ Auth Realm
 -cleanup       delete everything uploaded when done
 -directory+    postfix portion of directory to create
 -debug+        DAV debug level 1-3 (2 & 3 log req/resp to /tmp/perldav_debug.txt)
 -move          PUT text files then MOVE to executable
 -copy          PUT text files then COPY to executable
 -nocreate      don't create a directory
 -quiet         only print out summary
 -rand+         use this instead of a random string for filenames
 -sendbd+       send backdoors:
                        auto - for any succeeded test
                        ext - extension matching file name(s) in backdoors/ dir
 -uploadfile+   upload this file (requires -uploadloc)
 -uploadloc+    upload file to this relative location/name (requires -uploadfile)
 -url+          url of DAV location

Example: /usr/bin/davtest -url http://localhost/davdir
```


- Use Cadaver tool to connect to DAV with 
```
Usage: cadaver [OPTIONS] http://hostname[:port]/path
  Port defaults to 80, path defaults to '/'
Options:
  -t, --tolerant            Allow cd/open into non-WebDAV enabled collection.
  -r, --rcfile=FILE         Read script from FILE instead of ~/.cadaverrc.
  -p, --proxy=PROXY[:PORT]  Use proxy host PROXY and optional proxy port PORT.
  -V, --version             Display version information.
  -h, --help                Display this help message.
Please send bug reports and feature requests via <https://github.com/notroj/cadaver>
```

-- -

## RDP

RDP stands for Remote Desktop Protocol used for GUI remote access on windows. RDP uses TCP on port 3389.

- Use rdp_scanner metasploit module to check if RDP is running on given port.
- Use Hydra to bruteforce credentials for RDP.
- Use xfreerdp to login ```xfreerdp -u administrator -p password123 /v:192.168.1.1:3389```


-- -

##  MS17-010 SMB Vulnerability : EternalBlue
[EternalBlue](https://en.wikipedia.org/wiki/EternalBlue) is vulnerability found on service SMBv1 which enables arbitary code execution with highest privilege. We can use [Metasploit](../../Cyber_Security/Tools/Metasploit.md) module auxiliary/scanner/smb/smb_ms17_010  to check if system can be exploited for EternalBlue. It can be directly exploited use module exploit/windows/smb/ms17_010_eternalblue.

-- -

## RDP Vulnerability : BlueKeep
[BlueKeep](https://en.wikipedia.org/wiki/BlueKeep) is vulnerability found on service RDP which allows hacker to excute code using kernel exploitation. We can use [Metasploit](../../Cyber_Security/Tools/Metasploit.md) module auxiliary/scanner/rdp/cve_2019_0708_bluekeep  to check if system can be exploited for bluekeep and exploit it using module exploit/windows/rdp/cve_2019_0708_bluekeep_rce.  CVE-2019-0708

-- -

## SMB PsExec

The SMB protocol utilizes two levels of authentication, namely:
+ **User authentication** - Users must provide a username and password in order
to authenticate with the SMB server in order to access a share.
+ **Share authentication** - Users must provide a password in order to access
restricted share.


**SMB Authentication**
- Authentication Request : Client sends authentication request for account
- Encrypt String with user's hash : Server returns a random string
- Encrypted string : Client encrypts random string with account's hashed password
- Access granted : Server verifies the string and access is granted if right.

Brute force login credentials and Gain code execution
- Use [Metasploit](../../Cyber_Security/Tools/Metasploit.md) module smb_login to bruteforce or user [hydra](../../Cyber_Security/Tools/hydra.md).
- Use psexec.py or windows/smb/psexec metasploit module to login.

-- -

## WinRM : Windows Remote Management

Windows Remote Management (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems over TCP port 5985 and 5986 HTTPS.

Use [crackmapexec](../../Cyber_Security/Tools/crackmapexec.md) to bruteforce winrm credentials.
To bruteforce : ``` crackmapexec winrm ip -u username -p passwordFile ```
To execute code: ``` crackmapexec winrm ip -u username -p password -x "command" ```

Use [Metasploit](../../Cyber_Security/Tools/Metasploit.md)
- Bruteforce Login : auxiliary/scanner/winrm/winrm_login
- Login Methods supported : auxiliary/scanner/winrm/winrm_auth_methods
- Run command : auxiliary/scanner/winrm/winrm_cmd
- Get shell : exploit/windows/winrm/winrm_script_exec (FORCE_VBS true)
